<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SGS Academy | Attendance & Programs</title>

<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;padding:0;height:100%;
  font-family:'Lato',sans-serif;
  background:linear-gradient(70deg,#3d6e35,#0e4b64);
  color:#fff;overflow:hidden
}
body{display:flex;flex-direction:column;align-items:center;padding:20px}

.logo{max-width:30%;margin:20px 0 40px}
.hidden{display:none}

button{
  padding:10px 20px;
  background:#fff;
  color:#144F5F;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
  box-shadow:0 4px 10px rgba(0,0,0,.2)
}
button:hover{background:#144F5F;color:#fff}

.top-buttons{
  position:fixed;
  top:20px;
  right:20px;
  display:flex;
  gap:12px;
  z-index:999
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  justify-content:center;
  align-items:center;
  z-index:1000
}
.modal-content{
  background:#fff;
  color:#0E4B64;
  padding:20px;
  border-radius:12px;
  max-width:1000px;
  width:90%;
  max-height:85vh;
  overflow-y:auto
}
.modal-close{
  float:right;
  font-size:22px;
  cursor:pointer
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:16px
}

/* PROGRAM CARD */
.card{
  border:2px solid #cdebf5;
  border-radius:10px;
  padding:16px;
  transition:.2s;
  background:#fff;
}
.card:hover{
  border-color:#0E4B64;
  box-shadow:0 6px 16px rgba(0,0,0,.12)
}
.code{font-size:12px;font-weight:800;color:#517b89}

/* Clickable title like Instructor collapsible */
.course-title-btn{
  display:block;
  width:100%;
  text-align:left;
  background:none;
  border:none;
  padding:0;
  margin:6px 0 8px;
  font-family:'Lato',sans-serif;
  font-size:15px;
  font-weight:900;
  color:#0E4B64;
  cursor:pointer;
}
.course-title-btn:hover{color:#144F5F;text-decoration:underline}

/* Collapsible description in cards */
.desc{
  font-size:13px;color:#517b89;line-height:1.5;
  max-height:0;
  overflow:hidden;
  transition:max-height .35s ease;
}
.desc.active{max-height:260px}

.small-hint{
  font-size:11px;color:#517b89;font-weight:700;margin-top:6px
}

/* SUBJECT DESCRIPTION BOX ON PAGE */
.subject-box{
  width:90%;
  max-width:900px;
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.25);
  border-radius:14px;
  padding:16px;
  margin-top:10px;
  backdrop-filter: blur(8px);
}
.subject-box h3{
  margin:0 0 8px;
  font-size:16px;
  font-weight:900;
}
.subject-box .sub-line{
  font-size:14px;
  font-weight:900;
  margin-bottom:6px;
}
.subject-box .sub-desc{
  font-size:13px;
  line-height:1.6;
  opacity:.95;
}
</style>
</head>

<body>

<img src="SGS_Academy_Logo_White.png" class="logo hidden" id="logo">

<div class="top-buttons hidden" id="topButtons">
  <button onclick="showInstructorPool()">ðŸ‘¥ Our Instructors</button>
  <button onclick="showPrograms()">ðŸ“˜ Training Programs</button>
</div>

<!-- SUBJECT DESCRIPTION BOX ON PAGE -->
<div id="subjectBox" class="subject-box hidden">
  <h3>ðŸ“Œ Subject Description</h3>
  <div id="subjectBoxTitle" class="sub-line"></div>
  <div id="subjectBoxDesc" class="sub-desc"></div>
</div>

<!-- TRAINING PROGRAMS MODAL -->
<div class="modal" id="programsModal">
  <div class="modal-content">
    <span class="modal-close" onclick="closePrograms()">&times;</span>

    <div style="text-align:center;margin-bottom:20px">
      <img src="SGS_Academy_Logo_Blue.png" style="max-height:60px" onerror="this.style.display='none'">
      <h2>ðŸ“˜ Training Programs</h2>
      <p style="color:#517b89">Click the course title to view the description</p>
    </div>

    <div id="programsContent" class="grid"></div>
  </div>
</div>

<!-- PROGRAM DETAILS MODAL (kept from your code) -->
<div class="modal" id="programDetailsModal">
  <div class="modal-content" style="max-width:850px">
    <span class="modal-close" onclick="closeProgramDetails()">&times;</span>

    <div style="text-align:center;margin-bottom:15px">
      <img src="SGS_Academy_Logo_Blue.png" style="max-height:60px" onerror="this.style.display='none'">
      <h2 id="programDetailsTitle" style="margin:10px 0;color:#144F5F"></h2>
    </div>

    <div id="programDetailsDesc" style="font-size:14px;line-height:1.7;color:#517b89"></div>
  </div>
</div>

<!-- LOAD DATA -->
<script src="./instructors.js"></script>
<script src="./subjects.js"></script>

<script>
/* =========================
   SUBJECT HELPERS (RM002R -> RM002)
   ========================= */

function normalizeSubjectCode(code) {
  if (!code) return null;

  var c = String(code).trim().toUpperCase();

  // Prefer exact (allows explicit overrides like RM002R if you ever define it)
  if (window.subjectsMap && window.subjectsMap[c]) return c;

  // Rule: RM002R / RM002R1 / RM002R2 => RM002
  var base = c.match(/\b([A-Z]{2}\d{3})R\d*\b/);
  if (base && base[1]) return base[1];

  return c;
}

function getSubjectInfoByCode(rawCode) {
  if (!window.subjectsMap) return null;
  var code = normalizeSubjectCode(rawCode);
  return code && window.subjectsMap[code]
    ? { code: code, info: window.subjectsMap[code] }
    : null;
}

/* =========================
   PROGRAMS MODAL (ALL COURSES)
   - Click TITLE => toggle description (like instructor)
   - Also updates the on-page subject box
   - (Optional) still supports opening details modal via double-click
   ========================= */

function showPrograms(){
  var container = document.getElementById("programsContent");
  container.innerHTML = "";

  var map = window.subjectsMap;
  if (!map) {
    alert("subjects.js not loaded");
    return;
  }

  Object.keys(map).sort().forEach(function(code){
    var p = map[code] || {};

    var card = document.createElement("div");
    card.className = "card";

    var codeEl = document.createElement("div");
    codeEl.className = "code";
    codeEl.textContent = code;

    // Clickable title (single click toggles description)
    var titleBtn = document.createElement("button");
    titleBtn.className = "course-title-btn";
    titleBtn.type = "button";
    titleBtn.textContent = p.title || code;

    var descEl = document.createElement("div");
    descEl.className = "desc";
    descEl.textContent = p.description || "";

    var hint = document.createElement("div");
    hint.className = "small-hint";
    hint.textContent = "Click title to expand â–¾";

    titleBtn.addEventListener("click", function(e){
      e.preventDefault();

      // Close other open descriptions (keep UI clean like instructor)
      var opened = container.querySelectorAll(".desc.active");
      for (var i = 0; i < opened.length; i++) {
        if (opened[i] !== descEl) opened[i].classList.remove("active");
      }

      // Toggle current
      var isOpen = descEl.classList.toggle("active");
      hint.textContent = isOpen ? "Click title to collapse â–´" : "Click title to expand â–¾";

      // Update the on-page subject box (your "classes page" behavior)
      showSubjectOnPage(code);
    });

    // OPTIONAL: double click anywhere on card => open full details modal
    card.addEventListener("dblclick", function(){
      openProgramDetails(code);
    });

    card.appendChild(codeEl);
    card.appendChild(titleBtn);
    card.appendChild(descEl);
    card.appendChild(hint);

    container.appendChild(card);
  });

  document.getElementById("programsModal").style.display = "flex";
}

function closePrograms(){
  document.getElementById("programsModal").style.display = "none";
}

/* DETAILS MODAL (uses normalization) */
function openProgramDetails(code){
  var found = getSubjectInfoByCode(code);
  if (!found) return;

  var finalCode = found.code;
  var p = found.info;

  document.getElementById("programDetailsTitle").innerHTML =
    '<span style="color:#517b89;font-size:14px;font-weight:900">'+finalCode+'</span><br>' +
    (p.title || finalCode);

  document.getElementById("programDetailsDesc").textContent = p.description || "";
  document.getElementById("programDetailsModal").style.display = "flex";

  // Also show on page box
  showSubjectOnPage(finalCode);
}

function closeProgramDetails(){
  document.getElementById("programDetailsModal").style.display = "none";
}

/* SHOW SUBJECT DESCRIPTION ON PAGE (uses normalization) */
function showSubjectOnPage(code){
  var found = getSubjectInfoByCode(code);
  if (!found) return;

  var finalCode = found.code;
  var p = found.info;

  document.getElementById("subjectBoxTitle").textContent =
    finalCode + " â€” " + (p.title || "");

  document.getElementById("subjectBoxDesc").textContent = p.description || "";

  document.getElementById("subjectBox").classList.remove("hidden");
}

/* Instructor pool placeholder */
function showInstructorPool(){
  alert("Instructor pool already works â€” unchanged ðŸ˜Œ");
}

function init(){
  document.getElementById("logo").classList.remove("hidden");
  document.getElementById("topButtons").classList.remove("hidden");
}

document.readyState==="loading"
  ? document.addEventListener("DOMContentLoaded",init)
  : init();
</script>

</body>
</html>
